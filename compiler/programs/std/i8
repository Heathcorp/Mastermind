#include <bitops>

struct i8 {
  cell n;
}
// 0b11111111 = -1
// 0b00000000 = 0
// 0b00000001 = 1
// 0b00000010 = 2
// 0b01111111 = 127
// 0b10000000 = -128
// 0b10000001 = -127
// 0b10000010 = -126

// cell MAX_i8 = 127;
// cell MIN_i8 = -128;

fn is_neg(struct i8 a, cell _sign_neg) {
  copy a.n into _sign_neg;
  cell i = 7;
  tshift_r(_sign_neg, i);
}

fn to_u8(struct i8 a, cell _abs, cell _sign_neg) {
  copy a.n into _abs _sign_neg;

  {
    // shift so that _sign_neg is the most significant bit
    cell i = 7;
    tshift_r(_sign_neg, i);
  }

  if _sign_neg {
    _abs = -_abs;
  }
}

// debug/test code:
// #include "print.mmi"
// struct i8 a;
// a.n = 0;
// drain 2 {
//   drain 128 into a.n {
//     cell abs;
//     cell neg;
//     to_u8(n, abs, neg);
//     if not neg {
//       output '+';
//     } else {
//       output '-';
//     }
//     print(abs);
//     output '\n';
//   }
// }
